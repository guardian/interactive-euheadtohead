<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <style>
            @font-face {
                font-family: "Guardian Egyptian Web";
                src: url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Regular.eot");
                src: url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Regular.eot?#iefix") format("embedded-opentype"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Regular.woff2") format("woff2"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Regular.woff") format("woff"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Regular.ttf") format("truetype"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Regular.svg#GuardianEgyptianWeb-Regular") format("svg");
                font-weight: 400;
                font-style: normal;
                font-stretch: normal; 
            }  
            @font-face {
                font-family: "Guardian Egyptian Web";
                src: url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Semibold.eot");
                src: url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Semibold.eot?#iefix") format("embedded-opentype"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Semibold.woff2") format("woff2"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Semibold.woff") format("woff"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Semibold.ttf") format("truetype"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianEgyptianWeb/GuardianEgyptianWeb-Semibold.svg#GuardianEgyptianWeb-Semibold") format("svg");
                font-weight: 600;
                font-style: normal;
                font-stretch: normal; 
            }
            @font-face {
                font-family: "Guardian Text Sans Web";
                src: url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Regular.eot");
                src: url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Regular.eot?#iefix") format("embedded-opentype"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Regular.woff2") format("woff2"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Regular.woff") format("woff"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Regular.ttf") format("truetype"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Regular.svg#GuardianTextSansWeb-Regular") format("svg");
                font-weight: normal/*400;*/
                font-style: normal;
                font-stretch: normal; 
            }
            @font-face {
                font-family: "Guardian Text Sans Web";
                src: url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Bold.eot");
                src: url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Bold.eot?#iefix") format("embedded-opentype"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Bold.woff2") format("woff2"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Bold.woff") format("woff"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Bold.ttf") format("truetype"), url("https://interactive.guim.co.uk/fonts/guss-webfonts/GuardianTextSansWeb/GuardianTextSansWeb-Bold.svg#GuardianTextSansWeb-Bold") format("svg");
                font-weight: 700;
                font-style: normal;
                font-stretch: normal; 
            }
            html { -webkit-font-smoothing: antialiased; }
            /* for iOS safari mobile */
            body { -webkit-text-size-adjust: 100%; }
            /* for all but IE */
            path { vector-effect: non-scaling-stroke; }
            .d-n { display: none; }
        </style>
        <script src="https://interactive.guim.co.uk/libs/iframe-messenger/iframeMessenger.js"></script>
    </head>
    <body>
<div class="js-graph" style="color: rgb(118, 118, 118); font-family: 'Guardian Text Sans Web', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif; font-size: 13px; width: auto;" data-label-width="0" id="barHE">
    <header>
        <div style="color: black; font-family: 'Guardian Egyptian Web', Georgia, serif; font-weight: 600; font-size: 18px; line-height: 24px; margin-bottom: 12px;"><span>Actually, about half of it comes straight back</span></div>
        <div style="font-size: 14px; line-height: 20px; margin-top: 12px; margin-bottom: 16px;"><span>UK EU contributions, Â£m, including rebates and receipts</span></div>
        <div class="js-keys" style="line-height: 18px; margin-left: 0px;"><div style="white-space: nowrap; display: inline-block; margin-right: 12px;"><span style="display: inline-block; width: 7px; height: 11px; margin-right: 4px; border-radius: 2px; background-color: rgb(0, 87, 137);"></span><span>Net</span></div><div style="white-space: nowrap; display: inline-block; margin-right: 12px;"><span style="display: inline-block; width: 7px; height: 11px; margin-right: 4px; border-radius: 2px; background-color: rgb(128, 128, 128);"></span><span>Less rebate</span></div><div style="white-space: nowrap; display: inline-block; margin-right: 12px;"><span style="display: inline-block; width: 7px; height: 11px; margin-right: 4px; border-radius: 2px; background-color: rgb(189, 189, 189);"></span><span>Less public sector receipts</span></div></div>
    </header>
    <div style="position: relative; height: auto;"><div style="width: 100%; padding-top: 12px; margin-bottom: 32px;"><div style="min-height: 24px;"><div class="js-bars" style="position: relative; width: calc(100% - 0px); height: auto; display: inline-block;"><div style="color: rgb(0, 87, 137); font-size: 18px; font-weight: bold; width: 47.6573%; height: 24px; float: left; text-align: center;">8473</div><div style="color: rgb(128, 128, 128); font-size: 18px; font-weight: bold; width: 27.3412%; height: 24px; float: left; text-align: center;">4861</div><div style="color: rgb(189, 189, 189); font-size: 18px; font-weight: bold; width: 25.0014%; height: 24px; float: left; text-align: center;">4445</div><div style="width: 47.6573%; height: 72px; float: left; background-color: rgb(0, 87, 137);"></div><div style="width: 27.3412%; height: 72px; float: left; background-color: rgb(128, 128, 128);"></div><div style="width: 25.0014%; height: 72px; float: left; background-color: rgb(189, 189, 189);"></div></div></div></div><div class="js-axis" style="position: absolute; top: 0px; right: 0px; height: 100%; width: calc(100% - 0px);"></div></div>
    <footer style="font-size: 12px; line-height: 16px; margin-top: 8px; padding-top: 8px; border-top: 1px dotted #bdbdbd;">
        <div style="word-break: break-word">
            <span>Guardian graphic | Source: HM Treasury European Union Finances 2015</span>  
        </div>
        <!-- TODO: add ..  -->
    </footer>
    <div style="visibility: hidden;"><span class="js-test" style="font-size: 14px"></span></div>
</div><script>
    function debounce(func, wait, immediate) {
        var timeout;
        return function() {
            var context = this; 
            var args = arguments;
            var later = function() {
                timeout = null;
                if (!immediate) func.apply(context, args);
            };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) func.apply(context, args);
        };
    }; 

    function getWindowSize() {
        var w = window,
            d = document,
            e = d.documentElement,
            g = d.getElementsByTagName('body')[0],
            x = w.innerWidth || e.clientWidth || g.clientWidth  || w.outerWidth,
            y = w.innerHeight|| e.clientHeight|| g.clientHeight || w.outerHeight;
        // NOTE: outer is for android app

        return { width: x, height: y};
    }

    function calcGraphLayout() {
        var graphWidth = getWindowSize().width;

        var txts = Array.prototype.slice.call(document.querySelectorAll(".js-text")),
            bars = Array.prototype.slice.call(document.querySelectorAll(".js-bars")),
            keys = Array.prototype.slice.call(document.querySelectorAll(".js-keys")),
            axis = document.querySelector(".js-axis");

        // label width >= 1/3 graph width
        // => label: max-widht and bars: 66%; inline 
        if (labelWidth > graphWidth/3) {
            axis.style.width = "100%";
            keys.forEach(function(key) { key.style.marginLeft = 0; });
            txts.forEach(function(txt) { txt.style.width = "100%"; });
            bars.forEach(function(bar) { bar.style.width = "100%"; 
                bar.style.height = "24px"; bar.style.display = "block"; });
        } else {
            // label width >= graph width
            // => label: 100% and bars: 100% 
            axis.style.width = "calc(100% - " + (labelWidth + 0) + "px)";
            keys.forEach(function(key) { key.style.marginLeft = (labelWidth + 0) + "px"; });
            txts.forEach(function(txt) { txt.style.width = labelWidth + "px"; });
            bars.forEach(function(bar) { bar.style.width = "calc(100% - " + (labelWidth + 0) + "px)"; 
                bar.style.height = "auto"; bar.style.display = "inline-block"; });
        }
    }

    var graphEl = document.querySelector(".js-graph");
    var labelWidth = parseInt(graphEl.getAttribute("data-label-width"));//dataset.labelWidth);
    var state = labelWidth <= 100;
    
    var onResize = debounce(function() {
        calcGraphLayout();
        iframeMessenger.resize();
    }, 250);
    onResize();

    // handle event
    // if responsive needed, for embed
    if (!state) {
        window.addEventListener("resize", onResize);
    }
</script>
</body>
</html>
